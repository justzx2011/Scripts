#!/bin/bash
#this is a shell for playing anime videos.
#maplebeats'shell

temp_file=/tmp/cdb.$$

video_time(){
  echo -e "请输入片头曲完的时间分钟"
  read open_time_min
  echo -e "请输入片头曲完的时间秒"
  read open_time_sed
  open_time=`expr 60 \* $open_time_min + $open_time_sed`
  echo -e "请输入片尾曲开始的时间分钟"
  read end_time_min
  echo -e "请输入片尾曲开始的时间秒"
  read end_time_sed
  end_time=`expr 60 \* $end_time_min + $end_time_sed - $open_time`
return 0
}

creat_lst () {                      
find . \( -name "*.rmvb" -or -name "*.mp4" \) -type f | vim -c 'sort nr /\d\+/' -c 'w '$temp_file'' -c 'q' - && cat $temp_file >anime.lst && rm $temp_file
#find . \( -name "*.rmvb" \) -type f | sort > anime.lst
}

skip_open(){
  exec mplayer -fs -ss $open_time -playlist anime.lst >>/dev/null
return 0
}
skip_end(){
sleep $end_time && killall mplayer >>/dev/null && sed -i '1d' anime.lst &&play_video >>/dev/null
return 0
}

play_video(){
if [ -s anime.lst ];then         
  skip_end& 
  skip_open
else
rm -rf anime.lst
exit 0
fi
}

lst_presence(){                       
if [ -f ./anime.lst ]
then 
 return 0
else
 return 1
fi
}

video_time                      
if lst_presence         
then
  	play_video
else
 	creat_lst
	play_video
fi
exit 0


